<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pip-Boy Timer</title>

  <!-- Optional: load your local Monofonto woff2 -->
  <!--
  <style>
    @font-face{
      font-family:"Monofonto";
      src:url("./monofonto.woff2") format("woff2");
      font-display:swap;
    }
  </style>
  -->

  <!-- Fallback mono -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #040805;
      --g: #33ff66;
      --g2: rgba(51,255,102,.65);
      --g3: rgba(51,255,102,.30);
      --g4: rgba(51,255,102,.18);
      --ink: rgba(0,0,0,.75);
      --font: "Monofonto","Share Tech Mono",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;

      /* tweak these if you want */
      --scan-opacity: .55;
      --frame-radius: 22px;
      --bezel: 16px;
    }

    html,body{height:100%;margin:0;background:transparent;}
    *{box-sizing:border-box;}

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding: 16px;
    }

    /* Main CRT panel */
    .crt{
      position:relative;
      width:min(1200px, 96vw);
      aspect-ratio: 16 / 7;
      border-radius: var(--frame-radius);
      overflow:hidden;

      background:
        radial-gradient(140% 120% at 50% 22%, rgba(51,255,102,.15), transparent 55%),
        radial-gradient(120% 120% at 50% 60%, rgba(51,255,102,.08), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.75));

      border: 2px solid rgba(51,255,102,.25);
      box-shadow:
        0 30px 80px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.03);
      transform: translateZ(0);
    }

    /* Inner frame */
    .crt::before{
      content:"";
      position:absolute;
      inset: var(--bezel);
      border-radius: calc(var(--frame-radius) - 8px);
      border: 2px solid rgba(51,255,102,.18);
      box-shadow:
        inset 0 0 0 2px rgba(0,0,0,.55);
      pointer-events:none;
    }

    /* Subtle glow */
    .glow{
      position:absolute; inset:0;
      background:
        radial-gradient(70% 90% at 50% 40%, rgba(51,255,102,.20), transparent 65%),
        radial-gradient(60% 80% at 50% 55%, rgba(51,255,102,.10), transparent 70%);
      mix-blend-mode: screen;
      opacity:.85;
      pointer-events:none;
      filter: blur(.2px);
    }

    /* Scanlines */
    .scanlines{
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,0) 0px,
          rgba(0,0,0,0) 2px,
          rgba(0,0,0,.30) 3px
        );
      opacity: var(--scan-opacity);
      pointer-events:none;
      animation: scanMove 7.5s linear infinite;
    }
    @keyframes scanMove{
      0%{transform:translateY(0)}
      100%{transform:translateY(26px)}
    }

    /* Vignette */
    .vignette{
      position:absolute; inset:-18%;
      background: radial-gradient(closest-side, transparent 55%, rgba(0,0,0,.65) 95%);
      opacity:.85;
      pointer-events:none;
    }

    /* Grain */
    .grain{
      position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      opacity:.08;
      mix-blend-mode: overlay;
      pointer-events:none;
    }

    /* Tiny flicker */
    .flicker{
      position:absolute; inset:0;
      background: radial-gradient(50% 60% at 50% 50%, rgba(51,255,102,.28), transparent 70%);
      mix-blend-mode: screen;
      pointer-events:none;
      animation:flicker 6s infinite;
      opacity:.10;
    }
    @keyframes flicker{
      0%,100%{opacity:.06}
      12%{opacity:.12}
      24%{opacity:.05}
      38%{opacity:.14}
      52%{opacity:.07}
      70%{opacity:.12}
      86%{opacity:.05}
    }

    /* Content layout */
    .content{
      position:absolute;
      inset: calc(var(--bezel) + 10px);
      display:grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
      color: var(--g);
      font-family: var(--font);
      text-transform: uppercase;
      letter-spacing: .8px;
    }

    /* Top tabs row */
    .tabs{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 44px;
      font-size: clamp(14px, 1.7vw, 22px);
      padding-top: 6px;
      text-shadow: 0 0 14px rgba(51,255,102,.25);
    }
    .tabs .active{
      position:relative;
      opacity: 1;
    }
    .tabs span{
      opacity:.82;
    }
    .tabs .active::before{
      content:"";
      position:absolute;
      left:-18px;
      top:50%;
      width:9px;height:9px;
      border-radius:999px;
      background: var(--g);
      transform: translateY(-50%);
      box-shadow: 0 0 14px rgba(51,255,102,.55);
    }

    /* Secondary row (Timer / Hacking / Connect / Diagnostics) */
    .subtabs{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 34px;
      font-size: clamp(12px, 1.3vw, 18px);
      opacity: .85;
      letter-spacing: 1.6px;
    }

    /* Inner display area */
    .panel{
      position:relative;
      border-radius: 14px;
      border: 2px solid rgba(51,255,102,.18);
      background:
        linear-gradient(180deg, rgba(51,255,102,.06), rgba(0,0,0,.12)),
        radial-gradient(120% 160% at 50% 30%, rgba(51,255,102,.12), transparent 60%);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.55);
      overflow:hidden;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    /* Edge tick marks like the reference */
    .edgeTicks{
      position:absolute; inset: 10px;
      border-radius: 10px;
      pointer-events:none;
      opacity:.55;
      background:
        /* top ticks */
        repeating-linear-gradient(to right,
          rgba(51,255,102,.55) 0 2px,
          transparent 2px 18px),
        /* bottom ticks */
        repeating-linear-gradient(to right,
          rgba(51,255,102,.55) 0 2px,
          transparent 2px 18px),
        /* left ticks */
        repeating-linear-gradient(to bottom,
          rgba(51,255,102,.55) 0 2px,
          transparent 2px 18px),
        /* right ticks */
        repeating-linear-gradient(to bottom,
          rgba(51,255,102,.55) 0 2px,
          transparent 2px 18px);
      background-size:
        100% 2px,
        100% 2px,
        2px 100%,
        2px 100%;
      background-position:
        top left,
        bottom left,
        top left,
        top right;
      background-repeat:no-repeat;
      filter: drop-shadow(0 0 8px rgba(51,255,102,.25));
    }

    /* Timer digits */
    .timerBlock{
      display:grid;
      place-items:center;
      gap: 12px;
      width: 100%;
    }

    .digits{
      font-size: clamp(52px, 8.2vw, 120px);
      letter-spacing: .08em;
      line-height: 1;
      font-weight: 400;
      text-shadow:
        0 0 16px rgba(51,255,102,.35),
        0 0 40px rgba(51,255,102,.12);
      position: relative;
    }

    /* subtle phosphor bleed/ghost */
    .digits::after{
      content: attr(data-ghost);
      position:absolute;
      left: 1px; top: 1px;
      opacity:.18;
      filter: blur(.3px);
      pointer-events:none;
    }

    /* bottom labels row */
    .units{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 26px;
      font-size: clamp(12px, 1.6vw, 22px);
      opacity: .9;
      letter-spacing: 2px;
    }
    .units .sep{
      opacity:.75;
      color: rgba(51,255,102,.85);
    }

    /* bottom faint bar line */
    .bottomLine{
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(51,255,102,.22), transparent);
      opacity: .9;
      border-radius: 999px;
      margin: 2px 10px 0 10px;
    }

    /* Optional controls (hidden unless ?controls=1) */
    .controls{
      display:none;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding-bottom: 2px;
      font-size: 12px;
      opacity:.9;
    }
    .btn{
      border: 1px solid rgba(51,255,102,.30);
      background: rgba(0,0,0,.35);
      color: var(--g);
      font-family: var(--font);
      padding: 6px 10px;
      border-radius: 10px;
      cursor:pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .btn:hover{ border-color: rgba(51,255,102,.55); }

    /* Transparent overlay mode */
    body.transparent .crt{
      background: transparent;
      border-color: rgba(51,255,102,.22);
      box-shadow: none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="crt" id="crt">
      <div class="glow"></div>
      <div class="scanlines"></div>
      <div class="grain"></div>
      <div class="flicker"></div>
      <div class="vignette"></div>

      <div class="content">
        <div class="tabs">
          <span class="active">START</span>
          <span>INV</span>
          <span>DATA</span>
          <span>MAP</span>
          <span>RADIO</span>
        </div>

        <div class="subtabs">
          <span>TIMER</span>
          <span>HACKING</span>
          <span>CONNECT</span>
          <span>DIAGNOSTICS</span>
        </div>

        <div class="panel">
          <div class="edgeTicks"></div>
          <div class="timerBlock">
            <div class="digits" id="digits" data-ghost="00:00:00:00">00:00:00:00</div>
            <div class="bottomLine"></div>
            <div class="units">
              <span>DAYS</span><span class="sep">|</span>
              <span>HOURS</span><span class="sep">|</span>
              <span>MINUTES</span><span class="sep">|</span>
              <span>SECONDS</span>
            </div>
          </div>
        </div>

        <div class="controls" id="controls">
          <button class="btn" id="btnStop">Stop</button>
          <button class="btn" id="btnResume">Resume</button>
          <button class="btn" id="btnReset">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * Pip-Boy Count-Up Timer (multi-day safe)
     * - No drift: uses Date.now() - startEpoch
     * - Persists start time in localStorage
     *
     * URL params:
     *   ?key=mytimer        (storage key, default "pipboyTimer")
     *   ?autostart=1        (default 1) start immediately if no saved start
     *   ?controls=1         (show stop/resume/reset buttons)
     *   ?transparent=1      (transparent outer background for OBS)
     *   ?scan=0.4           (scanline opacity 0..1)
     */

    const qs = new URLSearchParams(location.search);
    const storageKey = qs.get("key") || "pipboyTimer";

    const autostart = (qs.get("autostart") ?? "1") !== "0";
    const showControls = (qs.get("controls") ?? "0") === "1";
    const transparent = (qs.get("transparent") ?? "0") === "1";

    const scanParam = qs.get("scan");
    if (scanParam !== null) {
      const v = Math.max(0, Math.min(1, Number(scanParam)));
      if (!Number.isNaN(v)) document.documentElement.style.setProperty("--scan-opacity", String(v));
    }
    if (transparent) document.body.classList.add("transparent");

    const digitsEl = document.getElementById("digits");
    const controlsEl = document.getElementById("controls");
    const btnStop = document.getElementById("btnStop");
    const btnResume = document.getElementById("btnResume");
    const btnReset = document.getElementById("btnReset");

    if (showControls) controlsEl.style.display = "flex";

    // State
    let startEpoch = null;      // ms timestamp when timer started
    let stoppedAt = null;       // ms timestamp when stopped
    let rafId = null;

    function loadState() {
      try {
        const raw = localStorage.getItem(storageKey);
        if (!raw) return false;
        const s = JSON.parse(raw);
        if (typeof s.startEpoch === "number") startEpoch = s.startEpoch;
        if (typeof s.stoppedAt === "number") stoppedAt = s.stoppedAt;
        return !!startEpoch;
      } catch {
        return false;
      }
    }

    function saveState() {
      try {
        localStorage.setItem(storageKey, JSON.stringify({ startEpoch, stoppedAt }));
      } catch {}
    }

    function setDigits(text) {
      digitsEl.textContent = text;
      digitsEl.setAttribute("data-ghost", text);
    }

    function pad2(n) { return String(n).padStart(2, "0"); }

    function formatElapsed(ms) {
      // total seconds
      const totalSec = Math.max(0, Math.floor(ms / 1000));

      const days = Math.floor(totalSec / 86400);
      const rem1 = totalSec - days * 86400;

      const hours = Math.floor(rem1 / 3600);
      const rem2 = rem1 - hours * 3600;

      const mins = Math.floor(rem2 / 60);
      const secs = rem2 - mins * 60;

      // Reference look: always 2 digits each block (days will roll after 99 visually)
      // If you want days to show more than 2 digits, change pad2(days) to String(days).
      return `${pad2(days)}:${pad2(hours)}:${pad2(mins)}:${pad2(secs)}`;
    }

    function nowMs() { return Date.now(); }

    function ensureStarted() {
      if (startEpoch == null) {
        startEpoch = nowMs();
        stoppedAt = null;
        saveState();
      }
    }

    function tick() {
      if (startEpoch == null) {
        setDigits("00:00:00:00");
      } else {
        const end = (stoppedAt != null) ? stoppedAt : nowMs();
        setDigits(formatElapsed(end - startEpoch));
      }
      rafId = requestAnimationFrame(tick);
    }

    function stopTimer() {
      if (startEpoch == null) return;
      if (stoppedAt == null) {
        stoppedAt = nowMs();
        saveState();
      }
    }

    function resumeTimer() {
      if (startEpoch == null) {
        ensureStarted();
        return;
      }
      if (stoppedAt != null) {
        // shift start so elapsed continues seamlessly
        const pausedDuration = nowMs() - stoppedAt;
        startEpoch += pausedDuration;
        stoppedAt = null;
        saveState();
      }
    }

    function resetTimer() {
      startEpoch = nowMs();
      stoppedAt = null;
      saveState();
    }

    // Controls
    btnStop?.addEventListener("click", stopTimer);
    btnResume?.addEventListener("click", resumeTimer);
    btnReset?.addEventListener("click", resetTimer);

    // Boot
    const hadState = loadState();
    if (!hadState && autostart) ensureStarted();

    // Render loop
    tick();

    // Optional: allow keyboard shortcuts when testing (not needed in OBS)
    window.addEventListener("keydown", (e) => {
      if (!showControls) return;
      if (e.key === " ") { // space toggles stop/resume
        e.preventDefault();
        if (stoppedAt == null) stopTimer(); else resumeTimer();
      }
      if (e.key.toLowerCase() === "r") resetTimer();
    });
  </script>
</body>
</html>
